<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Library of Juan José de Austria - Interactive Network</title>
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            overflow: hidden;
        }
        
        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: relative;
            z-index: 100;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        #controls {
            background: #16213e;
            padding: 15px 40px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        label {
            font-size: 14px;
            font-weight: 500;
        }
        
        input[type="text"], select {
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #0f3460;
            color: #eee;
            font-size: 14px;
            min-width: 200px;
        }
        
        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        #network {
            width: 100%;
            height: calc(100vh - 160px);
            background: #0f3460;
        }
        
        #info-panel {
            position: absolute;
            top: 180px;
            right: 20px;
            width: 350px;
            background: rgba(22, 33, 62, 0.95);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            display: none;
        }
        
        #info-panel.visible {
            display: block;
        }
        
        #info-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        #info-panel .detail {
            margin-bottom: 12px;
            font-size: 13px;
            line-height: 1.6;
        }
        
        #info-panel .label {
            color: #999;
            font-weight: 500;
            display: block;
            margin-bottom: 4px;
        }
        
        #info-panel .value {
            color: #eee;
        }
        
        #info-panel a {
            color: #667eea;
            text-decoration: none;
        }
        
        #info-panel a:hover {
            text-decoration: underline;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            color: #999;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 1;
        }
        
        .close-btn:hover {
            color: #fff;
        }
        
        #stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(22, 33, 62, 0.9);
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.8;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        #stats .stat {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        
        #stats .stat-label {
            color: #999;
        }
        
        #stats .stat-value {
            color: #667eea;
            font-weight: 600;
        }
        
        #legend {
            position: absolute;
            top: 180px;
            left: 20px;
            background: rgba(22, 33, 62, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        #legend h4 {
            margin-bottom: 10px;
            color: #667eea;
            font-size: 13px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        #instructions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(22, 33, 62, 0.9);
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.8;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            max-width: 300px;
        }
        
        #instructions h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        #instructions ul {
            list-style: none;
            padding: 0;
        }
        
        #instructions li {
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }
        
        #instructions li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #667eea;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>The Library of Juan José de Austria (1629-1679)</h1>
        <div class="subtitle">Interactive Network Visualization • 697 Works • 345 Authors • Real Data from Manuscript Inventory</div>
    </div>
    
    <div id="controls">
        <div class="control-group">
            <label for="search">Search:</label>
            <input type="text" id="search" placeholder="Search authors, subjects, places...">
        </div>
        
        <div class="control-group">
            <label for="filter">Filter by:</label>
            <select id="filter">
                <option value="all">All Network (Top 50 Authors)</option>
                <option value="authors">Authors Only</option>
                <option value="subjects">Authors + Subjects</option>
                <option value="places">Authors + Places</option>
                <option value="top10">Top 10 Authors</option>
                <option value="math-military">Mathematics & Military</option>
            </select>
        </div>
        
        <button onclick="resetView()">Reset View</button>
        <button onclick="togglePhysics()">Toggle Physics</button>
    </div>
    
    <div id="network"></div>
    
    <div id="info-panel">
        <button class="close-btn" onclick="closeInfo()">×</button>
        <div id="info-content"></div>
    </div>
    
    <div id="legend">
        <h4>Node Types</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #667eea;"></div>
            <span>Authors</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4ade80;"></div>
            <span>Subjects</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #fbbf24;"></div>
            <span>Places</span>
        </div>
    </div>
    
    <div id="stats">
        <div class="stat">
            <span class="stat-label">Total Works:</span>
            <span class="stat-value">697</span>
        </div>
        <div class="stat">
            <span class="stat-label">Total Authors:</span>
            <span class="stat-value">345</span>
        </div>
        <div class="stat">
            <span class="stat-label">Shown:</span>
            <span class="stat-value">Top 50</span>
        </div>
        <div class="stat">
            <span class="stat-label">Subjects:</span>
            <span class="stat-value">242 total</span>
        </div>
        <div class="stat">
            <span class="stat-label">Places:</span>
            <span class="stat-value">119 total</span>
        </div>
    </div>
    
    <div id="instructions">
        <h4>How to Navigate</h4>
        <ul>
            <li>Drag to pan the network</li>
            <li>Scroll to zoom in/out</li>
            <li>Click nodes for details</li>
            <li>Drag nodes to rearrange</li>
            <li>Use search to find items</li>
            <li>Try different filters!</li>
        </ul>
    </div>

    <script>
        // REAL DATA from Juan José de Austria library CSV
        const authors = [
            {id: 'a1', name: "Samuel Marolois", works: 6, viaf: '41953873', qid: 'Q2579137', subjects: ["Military science", "Mathematics", "Military engineering", "Military architecture", "Architecture", "Geometry", "Perspective", "Fortification"]},
            {id: 'a2', name: "Jean Errard de Bar-le-Duc", works: 5, viaf: '39461609', qid: 'Q3164630', subjects: ["Military science", "Mathematics", "Surveying", "Geometry", "Engineering", "Fortification", "Military Science"]},
            {id: 'a3', name: "Giovanni Antonio Magini", works: 5, viaf: '9893146', qid: 'Q1258642', subjects: ["Astronomy", "Mathematics", "Natural Philosophy", "Medicine", "Meteorology", "Astrology", "Trigonometry"]},
            {id: 'a4', name: "Athanasius Kircher", works: 4, viaf: '54152998', qid: 'Q34943', subjects: ["Philosophy", "Hieroglyphics", "Acoustics", "Mathematics", "Theology", "Natural Philosophy", "Antiquarianism", "Egyptology", "Music Theory", "Chronology", "Antiquities", "Biblical studies"]},
            {id: 'a5', name: "Juan Pérez de Moya", works: 4, viaf: '51698619', qid: 'Q5951351', subjects: ["Astronomy", "Mathematics", "Natural Philosophy", "Geometry", "Algebra", "Arithmetic"]},
            {id: 'a6', name: "Diego Enríquez de Villegas", works: 3, viaf: '59396109', qid: 'Q5783832', subjects: ["Military science", "Fortification", "Military administration", "Military architecture"]},
            {id: 'a7', name: "Christophorus Clavius", works: 3, viaf: '95174255', qid: 'Q156137', subjects: ["Astronomy", "Philosophy", "Mathematics", "Geometry", "Arithmetic"]},
            {id: 'a8', name: "Galileo Galilei", works: 3, viaf: '2470550', qid: 'Q307', subjects: ["Astronomy", "Physics", "Mathematics", "Natural Philosophy", "Mechanics", "Cosmology"]},
            {id: 'a9', name: "Johannes Kepler", works: 3, viaf: '41842150', qid: 'Q8963', subjects: ["Astronomy", "Geometry", "Mensuration", "Mathematics"]},
            {id: 'a10', name: "Niccolò Tartaglia", works: 3, viaf: '54355120', qid: 'Q28359666', subjects: ["Geometry", "Engineering", "Military Science", "Mathematics"]},
            {id: 'a11', name: "Juan Caramuel y Lobkowitz", works: 2, viaf: '61551989', qid: 'Q505582', subjects: ["Philosophy", "Astronomy", "Mathematics", "Theology", "Geometry", "Scholasticism"]},
            {id: 'a12', name: "Alessandro Piccolomini", works: 2, viaf: '27173237', qid: 'Q365219', subjects: ["Philosophy", "Astronomy", "Cosmography", "Natural Philosophy", "Mechanics"]},
            {id: 'a13', name: "Antoine de Ville", works: 2, viaf: '34515562', qid: 'Q2853825', subjects: ["Military science", "Astronomy", "Geography", "Astrology", "Engineering", "Navigation", "Fortification"]},
            {id: 'a14', name: "Marin Mersenne", works: 2, viaf: '71386526', qid: 'Q191026', subjects: ["Philosophy", "Physics", "Mathematics", "Theology", "Natural Philosophy", "Mechanics"]},
            {id: 'a15', name: "Muzio Oddi", works: 2, viaf: '64804607', qid: 'Q3868986', subjects: ["Astronomy", "Mathematics", "Surveying", "Gnomonics", "Geometry", "Military Science"]},
            {id: 'a16', name: "Luis Collado", works: 2, viaf: '76586792', qid: 'Q21092296', subjects: ["Military science", "Fortification", "Artillery", "Gunnery"]},
            {id: 'a17', name: "Carlo Theti", works: 2, viaf: '37191947', qid: 'Q23822463', subjects: ["Military science", "Fortification", "Architecture"]},
            {id: 'a18', name: "Mario Bettini", works: 2, viaf: '71503826', qid: 'Q1358539', subjects: ["Philosophy", "Physics", "Mathematics", "Natural Philosophy", "Mechanics"]},
            {id: 'a19', name: "John Napier", works: 2, viaf: '49268624', qid: 'Q191517', subjects: ["Logarithms", "Computation", "Mathematics", "Arithmetic"]},
            {id: 'a20', name: "Francesco Maurolico", works: 2, viaf: '59098946', qid: 'Q437281', subjects: ["Optics", "Mathematics", "Natural Philosophy"]},
            {id: 'a21', name: "Bartholomaeus Pitiscus", works: 2, viaf: '59877480', qid: 'Q62020', subjects: ["Trigonometry", "Mathematics"]},
            {id: 'a22', name: "Andreas Tacquet", works: 2, viaf: '41960564', qid: 'Q364066', subjects: ["Geometry", "Mathematics"]},
            {id: 'a23', name: "Oronce Finé (Orontius Finaeus)", works: 2, viaf: '7407834', qid: 'Q358408', subjects: ["Geometry", "Cosmography", "Mathematics", "Arithmetic"]},
            {id: 'a24', name: "Lorenzo Sirigatti", works: 2, viaf: '37101339', qid: 'Q3837562', subjects: ["Geometry", "Architecture", "Perspective", "Art"]},
            {id: 'a25', name: "Antonio de Nájera", works: 2, viaf: '95430844', qid: '', subjects: ["Natural philosophy", "Mathematics", "Meteorology", "Astrology", "Geometry"]},
            {id: 'a26', name: "Philipp Clüver (Philippus Cluverius)", works: 2, viaf: '32793558', qid: 'Q62814', subjects: ["Historical geography", "Geography", "Historical Geography"]},
            {id: 'a27', name: "Guidobaldo del Monte", works: 2, viaf: '41881092', qid: 'Q113812134', subjects: ["Physics", "Mathematics", "Mechanics", "Perspective", "Optics"]},
            {id: 'a28', name: "Simon Stevin", works: 2, viaf: '29535022', qid: 'Q212617', subjects: ["Military science", "Mathematics", "Natural Philosophy", "Engineering", "Navigation"]},
            {id: 'a29', name: "Jacques Besson", works: 2, viaf: '59160472', qid: 'Q1335919', subjects: ["Engineering", "Mechanics", "Technology", "Mathematics"]},
            {id: 'a30', name: "François Viète", works: 2, viaf: '29535232', qid: 'Q8753', subjects: ["Geometry", "Trigonometry", "Mathematics"]},
            {id: 'a31', name: "Johann Jakob von Wallhausen", works: 2, viaf: '62343428', qid: 'Q214213', subjects: ["Military science", "Infantry tactics", "Infantry", "Cavalry"]},
            {id: 'a32', name: "Diego Ufano", works: 2, viaf: '59188295', qid: '', subjects: ["Military science", "Fortification", "Artillery"]},
            {id: 'a33', name: "Pietro Paolo Floriani", works: 2, viaf: '51882595', qid: '', subjects: ["Military science", "Fortification", "Engineering", "Military engineering"]},
            {id: 'a34', name: "Pietro Sardi", works: 2, viaf: '22495131', qid: '', subjects: ["Military science", "Military architecture", "Fortification", "Artillery"]},
            {id: 'a35', name: "Gabriello Busca", works: 2, viaf: '17481868', qid: '', subjects: ["Military science", "Fortification", "Military engineering"]},
            {id: 'a36', name: "Andrea Argoli", works: 2, viaf: '49967254', qid: '', subjects: ["Astronomy", "Mathematics", "Medicine", "Astrology", "Geometry"]},
            {id: 'a37', name: "Giovanni Battista Riccioli", works: 2, viaf: '64064627', qid: 'Q455252', subjects: ["Astronomy", "Natural Philosophy", "Mathematics"]},
            {id: 'a38', name: "Ismaël Boulliau (Bullialdus)", works: 2, viaf: '71420261', qid: 'Q982784', subjects: ["Astronomy", "Geometry", "Natural Philosophy", "Mathematics"]},
            {id: 'a39', name: "Tycho Brahe", works: 2, viaf: '54943308', qid: 'Q7722', subjects: ["Astronomy", "Natural Philosophy", "Scientific instruments"]},
            {id: 'a40', name: "Niccolò Cabeo (Nicolaus Cabeus)", works: 2, viaf: '61691419', qid: 'Q983779', subjects: ["Aristotelian Philosophy", "Magnetism", "Physics", "Natural Philosophy", "Meteorology"]},
            {id: 'a41', name: "Joan Blaeu", works: 2, viaf: '106983391', qid: 'Q329811', subjects: ["Astronomy", "Geography", "Cartography", "Cosmography"]},
            {id: 'a42', name: "Philip Lansbergen", works: 2, viaf: '27424318', qid: 'Q1345251', subjects: ["Astronomy", "Natural Philosophy", "Mathematics"]},
            {id: 'a43', name: "Joan Blaeu (Johannes Blaeu)", works: 2, viaf: '106983572', qid: 'Q329811', subjects: ["Cartography", "Geography", "Atlases"]},
            {id: 'a44', name: "Thomas à Kempis", works: 2, viaf: '100227407', qid: 'Q132137', subjects: ["Spiritual exercises", "Devotional literature", "Theology"]},
            {id: 'a45', name: "Giovanni Botero", works: 2, viaf: '59109313', qid: 'Q982208', subjects: ["Statecraft", "History", "Political theory", "Geography", "Reason of State", "Political Theory"]},
            {id: 'a46', name: "Joseph Lange (Josephus Langius)", works: 1, viaf: '32352820', qid: 'Q1698338', subjects: ["Sententiae", "Polyanthea", "Commonplace book", "Reference"]},
            {id: 'a47', name: "Georg Horn (Georgius Hornius)", works: 1, viaf: '32353484', qid: 'Q64274', subjects: ["Geography", "Ancient History"]},
            {id: 'a48', name: "Juan de Zabaleta", works: 1, viaf: '61550813', qid: 'Q6299725', subjects: ["Social criticism", "Moral philosophy", "Literature"]},
            {id: 'a49', name: "Francesco Capecelatro", works: 1, viaf: '', qid: '', subjects: ["History", "Military history", "Italian Wars"]},
            {id: 'a50', name: "Michel Baudier", works: 1, viaf: '66548684', qid: 'Q3309182', subjects: ["History", "China", "Travel"]}
        ];
        
        const subjects = [
            {id: 's1', name: "Mathematics", count: 132},
            {id: 's2', name: "Military science", count: 83},
            {id: 's3', name: "Theology", count: 59},
            {id: 's4', name: "Geometry", count: 54},
            {id: 's5', name: "Fortification", count: 50},
            {id: 's6', name: "Astronomy", count: 50},
            {id: 's7', name: "Natural Philosophy", count: 43},
            {id: 's8', name: "History", count: 40},
            {id: 's9', name: "Architecture", count: 24},
            {id: 's10', name: "Philosophy", count: 21},
            {id: 's11', name: "Geography", count: 17},
            {id: 's12', name: "Engineering", count: 16},
            {id: 's13', name: "Optics", count: 15},
            {id: 's14', name: "Artillery", count: 14},
            {id: 's15', name: "Mechanics", count: 13},
            {id: 's16', name: "Arithmetic", count: 13},
            {id: 's17', name: "Perspective", count: 13},
            {id: 's18', name: "Biography", count: 12},
            {id: 's19', name: "Physics", count: 10},
            {id: 's20', name: "Cosmography", count: 10},
            {id: 's21', name: "Literature", count: 9},
            {id: 's22', name: "Hagiography", count: 9},
            {id: 's23', name: "Poetry", count: 8},
            {id: 's24', name: "Trigonometry", count: 8},
            {id: 's25', name: "Military architecture", count: 8},
            {id: 's26', name: "Military Science", count: 7},
            {id: 's27', name: "Medicine", count: 7},
            {id: 's28', name: "Military history", count: 6},
            {id: 's29', name: "Canon Law", count: 6},
            {id: 's30', name: "Biblical Commentary", count: 6}
        ];
        
        const places = [
            {id: 'p1', name: "Paris", count: 56},
            {id: 'p2', name: "Venice", count: 43},
            {id: 'p3', name: "Madrid", count: 36},
            {id: 'p4', name: "Lyon", count: 21},
            {id: 'p5', name: "Antwerp", count: 20},
            {id: 'p6', name: "Amsterdam", count: 19},
            {id: 'p7', name: "Rome", count: 15},
            {id: 'p8', name: "Leiden", count: 14},
            {id: 'p9', name: "Naples", count: 8},
            {id: 'p10', name: "Milan", count: 7},
            {id: 'p11', name: "Bolonia", count: 6},
            {id: 'p12', name: "Valencia", count: 6},
            {id: 'p13', name: "Roan", count: 6},
            {id: 'p14', name: "Çaragoça", count: 6},
            {id: 'p15', name: "Pisa", count: 5},
            {id: 'p16', name: "Cologne", count: 5},
            {id: 'p17', name: "Pavia", count: 5},
            {id: 'p18', name: "Francofort", count: 5},
            {id: 'p19', name: "Barzelona", count: 4},
            {id: 'p20', name: "Barcelona", count: 4}
        ];
        
        // Create nodes
        let nodes = [];
        
        // Add author nodes
        authors.forEach(author => {
            nodes.push({
                id: author.id,
                label: author.name,
                group: 'author',
                title: `<b>${author.name}</b><br>${author.works} works<br>VIAF: ${author.viaf}`,
                value: author.works * 3,
                type: 'author',
                data: author
            });
        });
        
        // Add subject nodes
        subjects.forEach(subject => {
            nodes.push({
                id: subject.id,
                label: subject.name,
                group: 'subject',
                title: `<b>${subject.name}</b><br>${subject.count} works`,
                value: subject.count / 2,
                type: 'subject',
                data: subject
            });
        });
        
        // Add place nodes
        places.forEach(place => {
            nodes.push({
                id: place.id,
                label: place.name,
                group: 'place',
                title: `<b>${place.name}</b><br>${place.count} publications`,
                value: place.count / 2,
                type: 'place',
                data: place
            });
        });
        
        // Create edges (connections) - Real connections from the data!
        let edges = [];
        
        // Connect authors to their subjects
        authors.forEach(author => {
            author.subjects.forEach(subjectName => {
                const subject = subjects.find(s => s.name === subjectName);
                if (subject) {
                    edges.push({
                        from: author.id,
                        to: subject.id,
                        color: {opacity: 0.25}
                    });
                }
            });
        });
        
        // Network configuration
        const container = document.getElementById('network');
        const data = {
            nodes: new vis.DataSet(nodes),
            edges: new vis.DataSet(edges)
        };
        
        const options = {
            nodes: {
                shape: 'dot',
                scaling: {
                    min: 10,
                    max: 50,
                    label: {
                        min: 11,
                        max: 18
                    }
                },
                font: {
                    size: 13,
                    color: '#ffffff',
                    face: 'Segoe UI'
                },
                borderWidth: 2,
                borderWidthSelected: 4
            },
            edges: {
                width: 0.5,
                color: {
                    color: 'rgba(255,255,255,0.15)',
                    highlight: 'rgba(102,126,234,0.8)'
                },
                smooth: {
                    type: 'continuous',
                    roundness: 0.5
                }
            },
            groups: {
                author: {
                    color: {
                        background: '#667eea',
                        border: '#5568d3',
                        highlight: {
                            background: '#7c8ef0',
                            border: '#667eea'
                        }
                    }
                },
                subject: {
                    color: {
                        background: '#4ade80',
                        border: '#22c55e',
                        highlight: {
                            background: '#6ee7a7',
                            border: '#4ade80'
                        }
                    }
                },
                place: {
                    color: {
                        background: '#fbbf24',
                        border: '#f59e0b',
                        highlight: {
                            background: '#fcd34d',
                            border: '#fbbf24'
                        }
                    }
                }
            },
            physics: {
                enabled: true,
                stabilization: {
                    enabled: true,
                    iterations: 200
                },
                barnesHut: {
                    gravitationalConstant: -12000,
                    centralGravity: 0.2,
                    springLength: 120,
                    springConstant: 0.04,
                    damping: 0.09,
                    avoidOverlap: 0.15
                }
            },
            interaction: {
                hover: true,
                tooltipDelay: 100,
                navigationButtons: true,
                keyboard: true
            }
        };
        
        const network = new vis.Network(container, data, options);
        
        // Store original data for filtering
        const originalNodes = nodes;
        const originalEdges = edges;
        let physicsEnabled = true;
        
        // Click handler to show node details
        network.on('click', function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const node = data.nodes.get(nodeId);
                showNodeInfo(node);
            }
        });
        
        function showNodeInfo(node) {
            const panel = document.getElementById('info-panel');
            const content = document.getElementById('info-content');
            
            let html = `<h3>${node.label}</h3>`;
            
            if (node.type === 'author') {
                html += `
                    <div class="detail">
                        <span class="label">Type:</span>
                        <span class="value">Author</span>
                    </div>
                    <div class="detail">
                        <span class="label">Works in Collection:</span>
                        <span class="value">${node.data.works}</span>
                    </div>
                    <div class="detail">
                        <span class="label">Subjects:</span>
                        <span class="value">${node.data.subjects.slice(0, 5).join(', ')}${node.data.subjects.length > 5 ? '...' : ''}</span>
                    </div>`;
                if (node.data.viaf) {
                    html += `
                    <div class="detail">
                        <span class="label">VIAF ID:</span>
                        <span class="value"><a href="https://viaf.org/viaf/${node.data.viaf}" target="_blank">${node.data.viaf}</a></span>
                    </div>`;
                }
                if (node.data.qid) {
                    html += `
                    <div class="detail">
                        <span class="label">Wikidata:</span>
                        <span class="value"><a href="https://www.wikidata.org/wiki/${node.data.qid}" target="_blank">${node.data.qid}</a></span>
                    </div>`;
                }
            } else if (node.type === 'subject') {
                html += `
                    <div class="detail">
                        <span class="label">Type:</span>
                        <span class="value">Subject Category</span>
                    </div>
                    <div class="detail">
                        <span class="label">Works:</span>
                        <span class="value">${node.data.count}</span>
                    </div>
                `;
            } else if (node.type === 'place') {
                html += `
                    <div class="detail">
                        <span class="label">Type:</span>
                        <span class="value">Publication Place</span>
                    </div>
                    <div class="detail">
                        <span class="label">Publications:</span>
                        <span class="value">${node.data.count}</span>
                    </div>
                `;
            }
            
            content.innerHTML = html;
            panel.classList.add('visible');
        }
        
        function closeInfo() {
            document.getElementById('info-panel').classList.remove('visible');
        }
        
        // Search functionality
        document.getElementById('search').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            if (searchTerm === '') {
                const allNodes = data.nodes.get();
                allNodes.forEach(node => {
                    data.nodes.update({id: node.id, color: undefined});
                });
                return;
            }
            
            const allNodes = data.nodes.get();
            const matchingIds = [];
            
            allNodes.forEach(node => {
                if (node.label.toLowerCase().includes(searchTerm)) {
                    matchingIds.push(node.id);
                    data.nodes.update({
                        id: node.id,
                        color: {
                            background: '#f59e0b',
                            border: '#ea580c'
                        }
                    });
                } else {
                    data.nodes.update({id: node.id, color: undefined});
                }
            });
            
            if (matchingIds.length > 0) {
                network.focus(matchingIds[0], {
                    scale: 1.5,
                    animation: {
                        duration: 500,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        });
        
        // Filter functionality
        document.getElementById('filter').addEventListener('change', function(e) {
            const filterValue = e.target.value;
            
            let nodesToShow = [];
            let edgesToShow = [];
            
            switch(filterValue) {
                case 'all':
                    data.nodes.clear();
                    data.nodes.add(originalNodes);
                    data.edges.clear();
                    data.edges.add(originalEdges);
                    break;
                    
                case 'authors':
                    nodesToShow = originalNodes.filter(n => n.type === 'author');
                    data.nodes.clear();
                    data.nodes.add(nodesToShow);
                    data.edges.clear();
                    break;
                    
                case 'subjects':
                    nodesToShow = originalNodes.filter(n => n.type === 'subject' || n.type === 'author');
                    edgesToShow = originalEdges.filter(e => {
                        const fromNode = originalNodes.find(n => n.id === e.from);
                        const toNode = originalNodes.find(n => n.id === e.to);
                        return fromNode && toNode && 
                               (fromNode.type === 'author' || fromNode.type === 'subject') &&
                               (toNode.type === 'author' || toNode.type === 'subject');
                    });
                    data.nodes.clear();
                    data.nodes.add(nodesToShow);
                    data.edges.clear();
                    data.edges.add(edgesToShow);
                    break;
                    
                case 'places':
                    nodesToShow = originalNodes.filter(n => n.type === 'place' || n.type === 'author');
                    data.nodes.clear();
                    data.nodes.add(nodesToShow);
                    data.edges.clear();
                    break;
                    
                case 'top10':
                    nodesToShow = originalNodes.filter(n => {
                        if (n.type === 'author') {
                            const idx = parseInt(n.id.substring(1));
                            return idx <= 10;
                        }
                        return n.type === 'subject';
                    });
                    edgesToShow = originalEdges.filter(e => {
                        return nodesToShow.some(n => n.id === e.from) && nodesToShow.some(n => n.id === e.to);
                    });
                    data.nodes.clear();
                    data.nodes.add(nodesToShow);
                    data.edges.clear();
                    data.edges.add(edgesToShow);
                    break;
                    
                case 'math-military':
                    const mathMilSubjects = originalNodes.filter(n => 
                        n.type === 'subject' && 
                        (n.label.includes('Math') || n.label.includes('Geometry') || 
                         n.label.includes('Military') || n.label.includes('Fortification') ||
                         n.label.includes('Artillery'))
                    );
                    const relatedAuthors = new Set();
                    originalEdges.forEach(e => {
                        if (mathMilSubjects.some(s => s.id === e.to)) {
                            relatedAuthors.add(e.from);
                        }
                    });
                    nodesToShow = originalNodes.filter(n => 
                        mathMilSubjects.some(s => s.id === n.id) || 
                        relatedAuthors.has(n.id)
                    );
                    edgesToShow = originalEdges.filter(e => 
                        nodesToShow.some(n => n.id === e.from) && 
                        nodesToShow.some(n => n.id === e.to)
                    );
                    data.nodes.clear();
                    data.nodes.add(nodesToShow);
                    data.edges.clear();
                    data.edges.add(edgesToShow);
                    break;
            }
            
            network.fit();
        });
        
        function resetView() {
            network.fit({
                animation: {
                    duration: 500,
                    easingFunction: 'easeInOutQuad'
                }
            });
        }
        
        function togglePhysics() {
            physicsEnabled = !physicsEnabled;
            network.setOptions({ physics: { enabled: physicsEnabled } });
        }
        
        // Stabilization progress
        network.on('stabilizationProgress', function(params) {
            console.log('Stabilization: ' + Math.round(params.iterations/params.total * 100) + '%');
        });
        
        network.on('stabilizationIterationsDone', function() {
            console.log('Network stabilized with real data!');
        });
    </script>
</body>
</html>